<div class="mb-6 lg:ml-4">
    <div id="main-image-section" class="relative">
        <!-- Back Icon (Top Left) -->
        <a href="{{ request.META.HTTP_REFERER }}" class="absolute top-4 left-4 z-10 md:hidden">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="-0.5 -0.5 16 16" id="Alt-Arrow-Left--Streamline-Solar"
                height="26" width="26">
                <desc>Alt Arrow Left Streamline Icon: https://streamlinehq.com</desc>
                <g id="Line Duotone/Arrows/Alt Arrow Left">
                    <!-- White border effect (stroked twice) -->
                    <path id="Vector-border" stroke="white" stroke-linecap="round" stroke-linejoin="round"
                        d="m9.375 3.125 -3.75 4.375 3.75 4.375" stroke-width="2"></path>
                    <!-- Original arrow (on top) -->
                    <path id="Vector" stroke="#000000" stroke-linecap="round" stroke-linejoin="round"
                        d="m9.375 3.125 -3.75 4.375 3.75 4.375" stroke-width="1"></path>
                </g>
            </svg>
        </a>

        <!-- Cart Icon (Top Right) -->
        <button class="absolute top-6 right-6 z-10 add-to-bag-button">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="-0.5 -0.5 16 16">
                <!-- White border paths (stroked wider and placed behind) -->
                <path
                    d="M2.13125 4.518750000000001h10.7375v7.75625a1.7874999999999999 1.7874999999999999 0 0 1 -1.7874999999999999 1.7874999999999999H3.9187499999999997a1.7874999999999999 1.7874999999999999 0 0 1 -1.7874999999999999 -1.7874999999999999V4.518750000000001Z"
                    fill="none" stroke="white" stroke-miterlimit="10" stroke-width="2"></path>
                <path
                    d="M4.518750000000001 6.30625V3.9187499999999997A2.9812499999999997 2.9812499999999997 0 0 1 7.5 0.9375a2.9812499999999997 2.9812499999999997 0 0 1 2.9812499999999997 2.9812499999999997v2.3874999999999997"
                    fill="none" stroke="white" stroke-miterlimit="10" stroke-width="2"></path>
                
                <!-- Original paths (on top) -->
                <path
                    d="M2.13125 4.518750000000001h10.7375v7.75625a1.7874999999999999 1.7874999999999999 0 0 1 -1.7874999999999999 1.7874999999999999H3.9187499999999997a1.7874999999999999 1.7874999999999999 0 0 1 -1.7874999999999999 -1.7874999999999999V4.518750000000001Z"
                    fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="1"></path>
                <path
                    d="M4.518750000000001 6.30625V3.9187499999999997A2.9812499999999997 2.9812499999999997 0 0 1 7.5 0.9375a2.9812499999999997 2.9812499999999997 0 0 1 2.9812499999999997 2.9812499999999997v2.3874999999999997"
                    fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="1"></path>
            </svg>        
        </button>

        <!-- Heart Icon (Below Cart) -->
        <form action="{% url 'add_wishlist' single_product.id %}" method="POST">
            {% csrf_token %}
            <button type="submit" class="absolute top-16 right-6 z-10">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-black" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <!-- White border (behind the original path) -->
                    <path 
                        stroke-linecap="round" 
                        stroke-linejoin="round" 
                        stroke-width="2.5" 
                        stroke="white"   
                        d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" 
                    />
                    <path 
                        stroke-linecap="round" 
                        stroke-linejoin="round" 
                        stroke-width="1.5" 
                        d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" 
                    />
                </svg>            
            </button>
        </form>

        <!-- Share Button (Bottom Right) -->
        <button class="absolute bottom-10 right-6 z-5 share-button" onclick="shareProduct()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                <!-- White border background (larger stroke) -->
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="white" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round" />
                <polyline points="17 8 12 3 7 8" stroke="white" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                <line x1="12" y1="3" x2="12" y2="15" stroke="white" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />

                <!-- Main icon (colored stroke) -->
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="currentColor" stroke-width="1"
                    stroke-linecap="round" stroke-linejoin="round" />
                <polyline points="17 8 12 3 7 8" stroke="currentColor" stroke-width="1" stroke-linecap="round"
                    stroke-linejoin="round" />
                <line x1="12" y1="3" x2="12" y2="15" stroke="currentColor" stroke-width="1" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg> 
        </button>

        <div class="absolute bottom-4 flex justify-center z-5 w-full md:hidden" id="dots-container">
        </div>

        <!-- Main Image -->
        <img id="mainImage" src="{{ single_product.images.url }}" class="w-full shadow-md">
    </div>
</div>

<!-- Include Hammer.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>

<script>
    const allImages = [
        "{{ single_product.images.url }}",
        {% for i in product_gallery %}
    "{{ i.image.url }}"{% if not forloop.last %}, {% endif %}
    {% endfor %}
    ];

    // Share product function
    function shareProduct() {
        if (navigator.share) {
            navigator.share({
                title: "{{ single_product.title }}",
                text: "Check out this product: {{ single_product.title }}",
                url: window.location.href
            }).catch(err => {
                console.log('Error sharing:', err);
                copyToClipboard();
            });
        } else {
            copyToClipboard();
        }
    }

    function copyToClipboard() {
        const el = document.createElement('textarea');
        el.value = window.location.href;
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);

        showMessage('Link copied to clipboard !');
    }

    // Wait for DOM to load
    document.addEventListener('DOMContentLoaded', function () {
        const mainImageSection = document.getElementById('main-image-section');
        const mainImage = document.getElementById('mainImage');
        let currentIndex = 0;

        // Initialize Hammer.js
        const hammer = new Hammer(mainImageSection);

        // Swipe left - next image
        hammer.on('swipeleft', function () {
            if (currentIndex < allImages.length - 1) {
                currentIndex++;
                changeImage(currentIndex);
            } else {
                // Optional: Loop back to first image
                currentIndex = 0;
                changeImage(currentIndex);
            }
        });

        // Swipe right - previous image
        hammer.on('swiperight', function () {
            if (currentIndex > 0) {
                currentIndex--;
                changeImage(currentIndex);
            } else {
                // Optional: Loop to last image
                currentIndex = allImages.length - 1;
                changeImage(currentIndex);
            }
        });

        // Change image function
        function changeImage(index) {
            mainImage.src = allImages[index];
            updateActiveIndicator(index);
        }

        // Optional: Add navigation indicators
        function createImageIndicators() {
            let dotsContainer = document.getElementById('dots-container');
            const indicatorContainer = document.createElement('div');
            indicatorContainer.className = 'image-indicators flex justify-center mt-2 space-x-2';

            allImages.forEach((_, index) => {
                const dot = document.createElement('span');
                dot.className = 'indicator-dot w-1 h-1 rounded-full bg-gray-100 cursor-pointer';
                dot.dataset.index = index;
                dot.addEventListener('click', () => {
                    currentIndex = index;
                    changeImage(currentIndex);
                });
                indicatorContainer.appendChild(dot);
            });

            dotsContainer.appendChild(indicatorContainer);
            updateActiveIndicator(0);
        }

        function updateActiveIndicator(index) {
            const dots = document.querySelectorAll('.indicator-dot');
            dots.forEach(dot => dot.classList.remove('bg-white'));
            dots.forEach(dot => dot.classList.remove('w-2'));
            dots.forEach(dot => dot.classList.add('w-1'));
            if (dots[index]) dots[index].classList.add('bg-white');
            if (dots[index]) dots[index].classList.add('w-2');
        }

        // Initialize indicators
        createImageIndicators();
    });
</script>